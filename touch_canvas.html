<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Media Pembelajaran: Merangkai Elemen Setrika Listrik (Touch)</title>

<style>
  body {
    font-family: "Poppins", sans-serif;
    background: linear-gradient(135deg, #e3f2fd, #f3f5f7);
    height: 100vh;
    margin: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding-top: 80px;
  }

  h1 {
    color: #2a4d8f;
    text-align: center;
    margin-bottom: 20px;
  }

  #btnBack {
    position: absolute;
    top: 15px; left: 15px;
    background: #4a90e2; color: white;
    border: none; border-radius: 50%;
    width: 48px; height: 48px;
    font-size: 22px; display: flex; align-items: center; justify-content: center;
    cursor: pointer; box-shadow: 0 3px 6px rgba(0,0,0,0.2);
    z-index: 999; transition: 0.3s;
  }

  #btnBack:hover { background: #3578d3; transform: scale(1.05); }

  #canvas_div {
    text-align: center;
  }

  canvas {
    border: 2px solid #2a4d8f;
    border-radius: 12px;
    background-color: white;
  }

  .controls {
    margin-top: 10px;
    text-align: center;
  }

  button, select {
    font-family: "Poppins", sans-serif;
    font-size: 14px;
    padding: 6px 12px;
    border-radius: 8px;
    border: 1px solid #ccc;
    cursor: pointer;
    margin: 5px;
  }

  .element-bar {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-top: 25px;
    padding: 10px;
  }

  .element-bar img {
    width: 70px;
    height: 70px;
    object-fit: contain;
    cursor: grab;
    transition: transform 0.2s;
  }

  .element-bar img:active {
    transform: scale(1.1);
  }

  /* Layer untuk elemen draggable */
  #elementsLayer {
    position: absolute;
    top: 100px;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
  }

  .resizable {
    position: absolute;
    pointer-events: auto;
  }

  .resizable img {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  #divKunci {
    display: none;
    margin-top: 20px;
    border: 2px dashed #999;
    padding: 10px;
    background: #fafafa;
  }
</style>
</head>
<body>

<button id="btnBack" onclick="window.history.back()">&#8592;</button>

<h1>Media Pembelajaran: Merangkai Elemen Setrika Listrik (Touch)</h1>

<div id="canvas_div">
  <canvas id="canvas" width="900" height="360"></canvas>

  <div class="controls">
    <button onclick="clearArea()">üßπ Clear Area</button>
    <button id="modeToggle">‚úèÔ∏è Mode: Gambar</button>
    <button id="btnKunci">üëÅÔ∏è Tampilkan Kunci Jawaban</button>
    Line width :
    <select id="selWidth">
      <option value="11">11</option>
      <option value="13" selected>13</option>
      <option value="15">15</option>
    </select>
    Color :
    <select id="selColor">
      <option value="black">black</option>
      <option value="blue" selected>blue</option>
      <option value="red">red</option>
      <option value="green">green</option>
      <option value="yellow">yellow</option>
      <option value="gray">gray</option>
    </select>
  </div>
</div>

<!-- Layer untuk elemen draggable -->
<div id="elementsLayer"></div>

<!-- Elemen Titik A - E -->
<div class="element-bar elemen">
  <img src="assets/titikA.png" alt="Titik A">
  <img src="assets/titikB.png" alt="Titik B">
  <img src="assets/titikC.png" alt="Titik C">
  <img src="assets/titikD.png" alt="Titik D">
  <img src="assets/titikE.png" alt="Titik E">
</div>

<!-- Div Kunci Jawaban -->
<div id="divKunci">
  <p>üîë Ini adalah tampilan kunci jawaban rangkaian setrika listrik.</p>
  <img src="assets/kunci_jawaban.png" alt="Kunci Jawaban" width="400">
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let mode = 'draw'; // 'draw' atau 'select' atau 'drag'
let ongoingTouches = [];
let offsetX, offsetY;
let placedElements = [];
let activeElement = null;

// --- TOGGLE MODE GAMBAR / PILIH ---
document.getElementById("modeToggle").addEventListener("click", () => {
  if (mode === 'draw') {
    mode = 'select';
    document.getElementById("modeToggle").textContent = "üñêÔ∏è Mode: Pilih Elemen";
  } else if (mode === 'select') {
    mode = 'drag';
    document.getElementById("modeToggle").textContent = "üß© Mode: Drag Elemen";
  } else {
    mode = 'draw';
    document.getElementById("modeToggle").textContent = "‚úèÔ∏è Mode: Gambar";
  }
});

// --- EVENT DRAW MODE ---
canvas.addEventListener("touchstart", handleStart, false);
canvas.addEventListener("touchmove", handleMove, false);
canvas.addEventListener("touchend", handleEnd, false);
canvas.addEventListener("touchcancel", handleEnd, false);

function handleStart(evt) {
  if (mode !== 'draw') return;
  evt.preventDefault();
  const touches = evt.changedTouches;
  offsetX = canvas.getBoundingClientRect().left;
  offsetY = canvas.getBoundingClientRect().top;
  for (let i = 0; i < touches.length; i++) ongoingTouches.push(copyTouch(touches[i]));
}

function handleMove(evt) {
  if (mode !== 'draw') return;
  evt.preventDefault();
  const touches = evt.changedTouches;
  for (let i = 0; i < touches.length; i++) {
    const color = document.getElementById('selColor').value;
    const idx = ongoingTouchIndexById(touches[i].identifier);
    if (idx >= 0) {
      ctx.beginPath();
      ctx.moveTo(ongoingTouches[idx].clientX - offsetX, ongoingTouches[idx].clientY - offsetY);
      ctx.lineTo(touches[i].clientX - offsetX, touches[i].clientY - offsetY);
      ctx.lineWidth = document.getElementById('selWidth').value;
      ctx.strokeStyle = color;
      ctx.lineJoin = "round";
      ctx.closePath();
      ctx.stroke();
      ongoingTouches.splice(idx, 1, copyTouch(touches[i]));
    }
  }
}

function handleEnd(evt) {
  if (mode !== 'draw') return;
  evt.preventDefault();
  const touches = evt.changedTouches;
  for (let i = 0; i < touches.length; i++) {
    const idx = ongoingTouchIndexById(touches[i].identifier);
    if (idx >= 0) ongoingTouches.splice(idx, 1);
  }
}

function copyTouch({ identifier, clientX, clientY }) {
  return { identifier, clientX, clientY };
}

function ongoingTouchIndexById(idToFind) {
  for (let i = 0; i < ongoingTouches.length; i++) {
    if (ongoingTouches[i].identifier === idToFind) return i;
  }
  return -1;
}

function clearArea() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  placedElements = [];
}

// --- FITUR BARU: DRAG DAN HAPUS ELEMEN ---
const elementsLayer = document.getElementById("elementsLayer");

document.querySelectorAll(".elemen img").forEach(el => {
  el.addEventListener("touchstart", e => {
    if (mode !== "drag") return;
    e.preventDefault();

    const imgSrc = el.src;
    const newEl = document.createElement("div");
    newEl.className = "resizable";
    newEl.style.left = "100px";
    newEl.style.top = "150px";
    newEl.style.width = "80px";
    newEl.style.height = "80px";

    const img = document.createElement("img");
    img.src = imgSrc;
    newEl.appendChild(img);
    elementsLayer.appendChild(newEl);

    initTouchDragZoom(newEl);
  });
});

// Fungsi untuk drag dan hapus elemen
function initTouchDragZoom(el) {
  let startX, startY, moving = false, longPressTimer;

  el.addEventListener("touchstart", e => {
    const touch = e.touches[0];
    startX = touch.clientX - el.offsetLeft;
    startY = touch.clientY - el.offsetTop;
    moving = true;

    // Deteksi long press untuk hapus
    longPressTimer = setTimeout(() => {
      moving = false;
      if (confirm("Hapus elemen ini?")) el.remove();
    }, 1000);
  });

  el.addEventListener("touchmove", e => {
    if (!moving) return;
    clearTimeout(longPressTimer);
    const touch = e.touches[0];
    el.style.left = `${touch.clientX - startX}px`;
    el.style.top = `${touch.clientY - startY}px`;
  });

  el.addEventListener("touchend", () => {
    clearTimeout(longPressTimer);
    moving = false;
  });
}

// --- FITUR KUNCI JAWABAN ---
const btnKunci = document.getElementById("btnKunci");
const divKunci = document.getElementById("divKunci");

btnKunci.addEventListener("click", () => {
  const visible = divKunci.style.display === "block";
  divKunci.style.display = visible ? "none" : "block";
  btnKunci.textContent = visible ? "üëÅÔ∏è Tampilkan Kunci Jawaban" : "üôà Sembunyikan Kunci Jawaban";
});
</script>
</body>
</html>
