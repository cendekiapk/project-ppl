<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Media Pembelajaran: Merangkai Elemen Setrika Listrik (Touch)</title>

<style>
  body {
    font-family: "Poppins", sans-serif;
    background: linear-gradient(135deg, #e3f2fd, #f3f5f7);
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  h1 {
    color: #2a4d8f;
    text-align: center;
    margin-top: 80px;
    font-size: clamp(16px, 3vw, 24px);
  }

  #btnBack {
    position: absolute;
    top: 15px; left: 15px;
    background: #4a90e2; color: white;
    border: none; border-radius: 50%;
    width: 48px; height: 48px;
    font-size: 22px;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; box-shadow: 0 3px 6px rgba(0,0,0,0.2);
    z-index: 999; transition: 0.3s;
  }

  #btnBack:hover { background: #3578d3; transform: scale(1.05); }

  /* Container responsif antara canvas dan kunci jawaban */
  #mainContainer {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    flex-wrap: wrap;
    width: 100%;
    max-width: 1200px;
    padding: 10px;
    gap: 15px;
  }

  #canvas_div {
    flex: 1 1 600px;
    text-align: center;
    position: relative;
  }

  canvas {
    width: 100%;
    height: auto;
    max-width: 900px;
    border: 2px solid #2a4d8f;
    border-radius: 12px;
    background-color: white;
  }

  #divKunci {
    flex: 0 1 280px;
    display: none;
    border: 2px dashed #999;
    padding: 10px;
    background: #fafafa;
    border-radius: 10px;
    text-align: center;
    align-self: flex-start;
  }

  #divKunci img {
    width: 100%;
    height: auto;
  }

  .controls {
    margin-top: 10px;
    text-align: center;
  }

  button, select {
    font-family: "Poppins", sans-serif;
    font-size: 14px;
    padding: 6px 12px;
    border-radius: 8px;
    border: 1px solid #ccc;
    cursor: pointer;
    margin: 5px;
  }

  .element-bar {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 15px;
    margin-top: 20px;
    padding: 10px;
  }

  .element-bar img {
    width: 70px;
    height: 70px;
    object-fit: contain;
    cursor: grab;
    transition: transform 0.2s;
  }

  .element-bar img:active {
    transform: scale(1.1);
  }

  #elementsLayer {
    position: absolute;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
  }

  .resizable {
    position: absolute;
    pointer-events: auto;
  }

  .resizable img {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }
</style>
</head>
<body>

<button id="btnBack" onclick="window.history.back()">&#8592;</button>
<h1>Media Pembelajaran: Merangkai Elemen Setrika Listrik (Touch)</h1>

<div id="mainContainer">
  <div id="canvas_div">
    <canvas id="canvas" width="900" height="360"></canvas>
    <div id="elementsLayer"></div>

    <div class="controls">
      <button onclick="clearArea()">üßπ Clear Area</button>
      <button id="modeToggle">üñêÔ∏è Mode: Pilih Elemen</button>
      <button id="btnKunci">üëÅÔ∏è Tampilkan Kunci Jawaban</button>
      <br>
      Line width :
      <select id="selWidth">
        <option value="11">11</option>
        <option value="13" selected>13</option>
        <option value="15">15</option>
      </select>
      Color :
      <select id="selColor">
        <option value="black">black</option>
        <option value="blue" selected>blue</option>
        <option value="red">red</option>
        <option value="green">green</option>
        <option value="yellow">yellow</option>
        <option value="gray">gray</option>
      </select>
    </div>
  </div>

  <div id="divKunci">
    <p>üîë Kunci Jawaban</p>
    <img src="assets/kunci_jawaban.png" alt="Kunci Jawaban">
  </div>
</div>

<div class="element-bar">
  <img src="assets/titikA.png" alt="Titik A">
  <img src="assets/titikB.png" alt="Titik B">
  <img src="assets/titikC.png" alt="Titik C">
  <img src="assets/titikD.png" alt="Titik D">
  <img src="assets/titikE.png" alt="Titik E">
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const elementsLayer = document.getElementById('elementsLayer');
let mode = 'select';
let ongoingTouches = [];

// --- Mode Toggle ---
document.getElementById("modeToggle").addEventListener("click", () => {
  if (mode === 'draw') {
    mode = 'select';
    document.getElementById("modeToggle").textContent = "üñêÔ∏è Mode: Pilih Elemen";
  } else {
    mode = 'draw';
    document.getElementById("modeToggle").textContent = "‚úèÔ∏è Mode: Gambar";
  }
});

// --- Event Gambar di Canvas ---
canvas.addEventListener("touchstart", handleStart, false);
canvas.addEventListener("touchmove", handleMove, false);
canvas.addEventListener("touchend", handleEnd, false);

function handleStart(evt) {
  if (mode !== 'draw') return;
  evt.preventDefault();
  const touches = evt.changedTouches;
  for (let i = 0; i < touches.length; i++) ongoingTouches.push(copyTouch(touches[i]));
}

function handleMove(evt) {
  if (mode !== 'draw') return;
  evt.preventDefault();
  const touches = evt.changedTouches;
  const rect = canvas.getBoundingClientRect();
  for (let i = 0; i < touches.length; i++) {
    const idx = ongoingTouchIndexById(touches[i].identifier);
    if (idx >= 0) {
      ctx.beginPath();
      ctx.moveTo(ongoingTouches[idx].clientX - rect.left, ongoingTouches[idx].clientY - rect.top);
      ctx.lineTo(touches[i].clientX - rect.left, touches[i].clientY - rect.top);
      ctx.lineWidth = document.getElementById('selWidth').value;
      ctx.strokeStyle = document.getElementById('selColor').value;
      ctx.lineJoin = "round";
      ctx.stroke();
      ongoingTouches.splice(idx, 1, copyTouch(touches[i]));
    }
  }
}

function handleEnd(evt) {
  if (mode !== 'draw') return;
  evt.preventDefault();
  const touches = evt.changedTouches;
  for (let i = 0; i < touches.length; i++) {
    const idx = ongoingTouchIndexById(touches[i].identifier);
    if (idx >= 0) ongoingTouches.splice(idx, 1);
  }
}

function copyTouch({ identifier, clientX, clientY }) {
  return { identifier, clientX, clientY };
}

function ongoingTouchIndexById(idToFind) {
  return ongoingTouches.findIndex(t => t.identifier === idToFind);
}

function clearArea() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  document.querySelectorAll(".resizable").forEach(e => e.remove());
}

// --- Drag & Drop Elemen ---
document.querySelectorAll(".element-bar img").forEach(img => {
  img.addEventListener("touchstart", e => {
    if (mode !== 'select') return;
    e.preventDefault();
    const touch = e.changedTouches[0];
    const newEl = document.createElement("div");
    newEl.className = "resizable";
    newEl.style.left = `${touch.clientX - 35}px`;
    newEl.style.top = `${touch.clientY - 35}px`;
    newEl.style.width = "70px";
    newEl.style.height = "70px";
    const clone = document.createElement("img");
    clone.src = img.src;
    newEl.appendChild(clone);
    elementsLayer.appendChild(newEl);
    initDragDelete(newEl);
  });
});

function initDragDelete(el) {
  let startX, startY, moving = false, longPressTimer;
  el.addEventListener("touchstart", e => {
    const touch = e.touches[0];
    startX = touch.clientX - el.offsetLeft;
    startY = touch.clientY - el.offsetTop;
    moving = true;
    longPressTimer = setTimeout(() => {
      moving = false;
      if (confirm("Hapus elemen ini?")) el.remove();
    }, 1000);
  });
  el.addEventListener("touchmove", e => {
    if (!moving) return;
    clearTimeout(longPressTimer);
    const touch = e.touches[0];
    const parentRect = elementsLayer.getBoundingClientRect();
    el.style.left = `${touch.clientX - startX - parentRect.left}px`;
    el.style.top = `${touch.clientY - startY - parentRect.top}px`;
  });
  el.addEventListener("touchend", () => {
    clearTimeout(longPressTimer);
    moving = false;
  });
}

// --- Tampilkan/Sembunyikan Kunci Jawaban ---
const btnKunci = document.getElementById("btnKunci");
const divKunci = document.getElementById("divKunci");
btnKunci.addEventListener("click", () => {
  const visible = divKunci.style.display === "block";
  divKunci.style.display = visible ? "none" : "block";
  btnKunci.textContent = visible ? "üëÅÔ∏è Tampilkan Kunci Jawaban" : "üôà Sembunyikan Kunci Jawaban";
});
</script>
</body>
</html>
